
{% set description = node.get('field_description').getValue()[0]['value'] %}
{% if content.field_image['#items'] %}
  {% set image = content.field_image %}
{% endif %}
{% include "@molecules/06-headers/01-content-head.twig" with {
  "title": node.getTitle(),
  "description": description,
  "image": image
} %}
<div>
{% if dept_fields.featured_items %}
  <div class="sfgov-dept-featured-items">
    <div>
      {% for featured_item in dept_fields.featured_items %}
        {% include "@molecules/11-featured-item/11-featured-item.twig" with {
          "title": featured_item.title | t,
          "description": featured_item.description | t,
          "url": featured_item.url | t
        }%}
      {% endfor %}
    </div>
  </div>
{% endif %}
  <div class="sfgov-dept-in-this-page"></div>
{% if dept_fields.services.values %}
  <div class="sfgov-dept-services-list">
    <h3>{{ dept_fields.services.label }}</h3>
    <div class="sfgov-services-container"> {# table #}
    {% for service in dept_fields.services.values %}
        <div class="sfgov-services-section">
          <h4>{{ service.title }}</h4>
          <div class="sfgov-services-transactions-container">
            {% set i = 3 %}
            {% for transaction in service.transactions %}
              {% if loop.first %}
              <div class="sfgov-services-transactions" data-attr="row">
              {% endif %}
                {% include "@molecules/12-service-card/12-service-card.twig" with {
                  "title": transaction.tx_title,
                  "description": transaction.tx_description,
                  "url": '#'
                }%}
                {% set i = i - 1 %}
              {% if loop.index is divisible by(3) %}
                </div><div class="sfgov-services-transactions" data-attr="row">
              {% endif %}
              {% if loop.last %}
                {% if i >= 1 %}
                  {% for n in 1..i %}
                    {% include "@molecules/12-service-card/12-service-card.twig" with {
                      "title": '',
                      "description": '',
                      "url": '',
                      "empty": true
                    }%}
                  {% endfor %}
                {% endif %}
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
    {% endfor %}
    </div>
  </div>
{% endif %}

{% if dept_fields.spotlight %}
  <div class="sfgov-dept-spotlight">
    {% include "@molecules/13-spotlight/13-spotlight.twig" with {
      "title": dept_fields.spotlight.title,
      "description": dept_fields.spotlight.description,
      "button_text": dept_fields.spotlight.button_text,
      "button_uri": dept_fields.spotlight.button_uri,
      "image_url": dept_fields.spotlight.image_url
    }%}
  </div>
{% endif %}
  <div class="sfgov-dept-news"></div>
  <div class="sfgov-dept-events"></div>

{% if dept_fields.resources.items %}
  {# <pre>
    {{ dump(dept_fields.resources) }}
  </pre>   #}
  <div class="sfgov-dept-resources">
    <h3>{{ dept_fields.resources.label }}</h3>
    <div class="sfgov-dept-resources-container">
      <div class="sfgov-dept-resource-items">
      {% set i = 2 %}
      {% for item in dept_fields.resources.items %}
          {% include "@molecules/14-resource-card/14-resource-card.twig" with {
            "title": item.title,
            "description": item.description,
            "url": item.url
          }%}
          {% set i = i - 1 %}
        {% if loop.index is divisible by (2) and not loop.last %}
          </div><div class="sfgov-dept-resources-container">
          {% set i = 2 %}
        {% endif %}
        {% if loop.last and i >= 1 %}
          {% for n in 1..i %}
            {% include "@molecules/14-resource-card/14-resource-card.twig" with {
              "title": '',
              "description": '',
              "url": '',
              "empty": true
            }%}
          {% endfor %}
        {% endif %}
      {% endfor %}
      </div>
    </div>
  </div>
{% endif %}

  <div class="sfgov-dept-about"></div>
  
  <div class="sfgov-dept-contact">
    {% include "@organisms/06-contact/06-contact.twig" with {
      "address": dept_fields.address,
      "phone_numbers": dept_fields.phone_numbers,
      "email": dept_fields.email
    } %}
  </div>

  {# {% set render_content = false %}

  {% if node.get('field_url').isEmpty() == false %}
    {% set render_content = true %}
  {% elseif node.get('field_address').isEmpty() == false %}
    {% set render_content = true %}
  {% elseif node.get('field_phone_numbers').isEmpty() == false %}
    {% set render_content = true %}
  {% endif %}

  {% if render_content %}
    {% include "@organisms/04-containers/01-sidebar.twig" with {
      "side": "right",
      "title": "Contact"|t,
      "content": [content.field_url,
        content.field_address,
        content.field_phone_numbers]
    } %}
  {% endif %} #}

  {# Dept Fields: <br/>
  <pre>
  {{ dump(dept_fields) }}
  </pre>

  Services section: <br/>
  <pre>
  {{ dump(dept_fields.services) }}
  </pre>

  First service section: <br/>
  title: {{ dept_fields.services.values.0.title}}
  <pre>
  {{ dump(dept_fields.services.values.0.transactions) }}
  </pre> #}
</div>

