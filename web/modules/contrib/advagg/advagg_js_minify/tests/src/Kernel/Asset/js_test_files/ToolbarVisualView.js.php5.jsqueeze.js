(function(t,e,a,o){'use strict';e.toolbar.ToolbarVisualView=o.View.extend({events:function(){var t=function(t){t.preventDefault();t.target.click()};return{'click .toolbar-bar .toolbar-tab .trigger':'onTabClick','click .toolbar-toggle-orientation button':'onOrientationToggleClick','touchend .toolbar-bar .toolbar-tab .trigger':t,'touchend .toolbar-toggle-orientation button':t}},initialize:function(t){this.strings=t.strings;this.listenTo(this.model,'change:activeTab change:orientation change:isOriented change:isTrayToggleVisible',this.render);this.listenTo(this.model,'change:mqMatches',this.onMediaQueryChange);this.listenTo(this.model,'change:offsets',this.adjustPlacement);this.$el.find('.toolbar-tray .toolbar-lining').append(e.theme('toolbarOrientationToggle'));this.model.trigger('change:activeTab')},render:function(){this.updateTabs();this.updateTrayOrientation();this.updateBarAttributes();if(this.model.changed.orientation==='vertical'||this.model.changed.activeTab){this.loadSubtrees()};window.setTimeout(function(){e.displace(!0)},0);return this},onTabClick:function(t){if(t.target.hasAttribute('data-toolbar-tray')){var a=this.model.get('activeTab'),e=t.target;this.model.set('activeTab',(!a||e!==a)?e:null);t.preventDefault();t.stopPropagation()}},onOrientationToggleClick:function(t){var o=this.model.get('orientation'),e=(o==='vertical')?'horizontal':'vertical',a=e==='vertical';if(a){localStorage.setItem('Drupal.toolbar.trayVerticalLocked','true')}
else{localStorage.removeItem('Drupal.toolbar.trayVerticalLocked')};this.model.set({locked:a,orientation:e},{validate:!0,override:!0});t.preventDefault();t.stopPropagation()},updateTabs:function(){var e=t(this.model.get('activeTab'));t(this.model.previous('activeTab')).removeClass('is-active').prop('aria-pressed',!1);t(this.model.previous('activeTray')).removeClass('is-active');if(e.length>0){e.addClass('is-active').prop('aria-pressed',!0);var r=e.attr('data-toolbar-tray'),o=e.get(0).id;if(o){localStorage.setItem('Drupal.toolbar.activeTabID',JSON.stringify(o))};var a=this.$el.find('[data-toolbar-tray="'+r+'"].toolbar-tray');if(a.length){a.addClass('is-active');this.model.set('activeTray',a.get(0))}
else{this.model.set('activeTray',null)}}
else{this.model.set('activeTray',null);localStorage.removeItem('Drupal.toolbar.activeTabID')}},updateBarAttributes:function(){var t=this.model.get('isOriented');if(t){this.$el.find('.toolbar-bar').attr('data-offset-top','')}
else{this.$el.find('.toolbar-bar').removeAttr('data-offset-top')};this.$el.toggleClass('toolbar-oriented',t)},updateTrayOrientation:function(){var e=this.model.get('orientation'),t=(e==='vertical')?'horizontal':'vertical',a=this.$el.find('.toolbar-tray').removeClass('toolbar-tray-horizontal toolbar-tray-vertical').addClass('toolbar-tray-'+e),i='toolbar-icon-toggle-'+e,r='toolbar-icon-toggle-'+t,o=this.$el.find('.toolbar-toggle-orientation').toggle(this.model.get('isTrayToggleVisible'));o.find('button').val(t).attr('title',this.strings[t]).text(this.strings[t]).removeClass(i).addClass(r);var s=document.documentElement.dir,l=(s==='rtl')?'right':'left';a.removeAttr('data-offset-left data-offset-right data-offset-top');a.filter('.toolbar-tray-vertical.is-active').attr('data-offset-'+l,'');a.filter('.toolbar-tray-horizontal.is-active').attr('data-offset-top','')},adjustPlacement:function(){var t=this.$el.find('.toolbar-tray');if(!this.model.get('isOriented')){t.css('margin-top',0);t.removeClass('toolbar-tray-horizontal').addClass('toolbar-tray-vertical')}
else{t.css('margin-top',this.$el.find('.toolbar-bar').outerHeight())}},loadSubtrees:function(){var n=t(this.model.get('activeTab')),s=this.model.get('orientation');if(!this.model.get('areSubtreesLoaded')&&typeof n.data('drupal-subtrees')!=='undefined'&&s==='vertical'){var r=a.toolbar.subtreesHash,o=a.ajaxPageState.theme,c=e.url('toolbar/subtrees/'+r),d=localStorage.getItem('Drupal.toolbar.subtreesHash.'+o),l=JSON.parse(localStorage.getItem('Drupal.toolbar.subtrees.'+o)),i=this.model.get('orientation')==='vertical';if(i&&r===d&&l){e.toolbar.setSubtrees.resolve(l)}
else if(i){localStorage.removeItem('Drupal.toolbar.subtreesHash.'+o);localStorage.removeItem('Drupal.toolbar.subtrees.'+o);e.ajax({url:c}).execute();localStorage.setItem('Drupal.toolbar.subtreesHash.'+o,r)}}}})}(jQuery,Drupal,drupalSettings,Backbone));