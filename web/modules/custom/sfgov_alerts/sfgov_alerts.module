<?php

/**
 * @file
 * Contains sfgov_alerts.module.
 */

use Drupal\sfgov_alerts\Alert;

/**
 * Implements hook_theme().
 */
function sfgov_alerts_theme() {
  return [
    'sfgov_alerts' => [
      'render element' => 'content',
    ],
  ];
}

/**
 * @param $node
 *
 * Implements hook_node_presave().
 */
function sfgov_alerts_node_presave($node) {
  $type = $node->getType();

  if ($type == 'department') {

    $alert_type = $node->label();
    $alert_expiration_original = $node->original->field_alert_expiration_date->value;
    $alert_expiration_updated = $node->field_alert_expiration_date->value;
    $alert_text_updated = $node->field_alert_text->value;

    $alert = new Alert(
      $alert_type,
      $alert_text_updated,
      $alert_expiration_original,
      $alert_expiration_updated
    );
    $alert->notify();
  }
}
